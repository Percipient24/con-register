"use strict";angular.module("catReceiptApp",["ngRoute","ngSanitize"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("catReceiptApp").controller("MainCtrl",["$scope","ItemService","SalesService","BundleService","$interval","$timeout",function(a,b,c,d,e,f){function g(c,e){confirm("Are you sure you want to delete "+c.name+"?")&&(c.bundle?(a.bundles.splice(e,1),d.flush()):(a.items.splice(e,1),b.flush()))}var h,i;a.date=(new Date).getTime(),a.item_create={visible:!1,name:"",cost:"",owner:0,stock:0},a.bundle_create={visible:!1,name:"",cost:"",owner:2},a.export_create={visible:!1,content:"I am on a horse."},e(function(){a.date=(new Date).getTime()},1e3),a.items=b.items,a.bundles=d.bundles,a.sales=c.sales,a.cart=[],a.total=0,a.addToCart=function(b,c,d){if(b.altKey)g(c,d);else{var e=(new Date).getTime(),f={name:c.name,cost:c.cost,time:e};a.total+=parseFloat(c.cost),a.cart.push(f)}},a.removeFromCart=function(b){a.cart.splice(b,1),a.total=0;for(var c=0;c<a.cart.length;c++){var d=a.cart[c];a.total+=parseFloat(d.cost),d.is_bundle&&(a.total=parseFloat(d.cost))}},a.purchase=function(d){if(confirm("Customer pays $"+parseFloat(a.total).toFixed(2)+(d?" in CASH?":" on CARD?"))){for(var e,f,g=0;g<a.cart.length;g++){e=a.cart[g];for(var h=0;h<a.items.length;h++)f=a.items[h],e.name!==f.name||f.bundle||(f.stock--,h=a.items.length)}b.flush(),c.addSale(a.cart,a.total,d),a.cart=[],a.total=0}},a.toggleCreateItem=function(){a.item_create.visible=!a.item_create.visible},a.beginRemoveItem=function(a,b){h=f(function(){g(a,b)},3e3)},a.endRemoveItem=function(){f.cancel(h)},a.beginRemoveBundle=function(a,b){i=f(function(){g(a,b)},3e3)},a.endRemoveBundle=function(){f.cancel(i)},a.toggleCreateBundle=function(){a.bundle_create.visible=!a.bundle_create.visible},a.toggleCreateExport=function(){a.export_create.visible=!a.export_create.visible;var b,c,d,e,f="";if(a.export_create.visible){f+="items\n",f+="name	cost	owner	stock\n";for(var g=0;g<a.items.length;g++)b=a.items[g],f+=[b.name,b.cost,b.owner,b.stock].join("	")+"\n";f+="\nbundles\n",f+="name	cost	owner\n";for(var g=0;g<a.bundles.length;g++)c=a.bundles[g],f+=[c.name,c.cost,c.owner].join("	")+"\n";f+="\nsales\n",f+="sale_id	total	time	cash\n";for(var h="\ncart_contents\nsale_id	name	cost\n",g=0;g<a.sales.length;g++){d=a.sales[g],f+=[g,d.total,d.time,d.cash].join("	")+"\n";for(var i=0;i<d.cart.length;i++)e=d.cart[i],h+=[g,e.name,e.cost].join("	")+"\n"}f+=h}a.export_create.content=f},a.createItem=function(c){b.addItem(a.item_create.name,a.item_create.cost,a.item_create.owner,a.item_create.stock),a.item_create.name="",a.item_create.stock=0,a.item_create.visible=c},a.createBundle=function(b){d.addBundle(a.bundle_create.name,a.bundle_create.cost,a.bundle_create.owner),a.bundle_create.name="",a.bundle_create.visible=b},a.nukeItems=function(){confirm("Are you sure you want to empty all items?")&&b.nukeItems()},a.nukeBundles=function(){confirm("Are you sure you want to clear all bundle records?")&&d.nukeBundles()},a.nukeSales=function(){confirm("Are you sure you want to clear all sales records?")&&c.nukeSales()}}]),angular.module("catReceiptApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("catReceiptApp").service("ItemService",["ItemFactory",function(a){var b=this;this.items=[],this.nukeItems=function(){for(;this.items.length>0;)this.items.pop();localStorage.setItem("ItemService_items",JSON.stringify(this.items))},this.flush=function(){localStorage.setItem("ItemService_items",JSON.stringify(this.items))},this.addItem=function(a,b,c,d,e){var f={name:a,cost:b,owner:c,stock:d};this.items.push(f),e||this.flush()},localStorage.getItem("ItemService_items")&&0!==JSON.parse(localStorage.getItem("ItemService_items")).length?this.items=JSON.parse(localStorage.getItem("ItemService_items")):a.request().then(function(c){a.parse(b,c)})}]),angular.module("catReceiptApp").service("SalesService",[function(){this.sales=[],this.nukeSales=function(){for(;this.sales.length>0;)this.sales.pop();localStorage.setItem("SalesService_sales",JSON.stringify(this.sales))},this.addSale=function(a,b,c){var d={cart:a,total:b,cash:c,time:(new Date).getTime()};this.sales.push(d),localStorage.setItem("SalesService_sales",JSON.stringify(this.sales))},localStorage.getItem("SalesService_sales")?this.sales=JSON.parse(localStorage.getItem("SalesService_sales")):localStorage.setItem("SalesService_sales",JSON.stringify(this.sales))}]),angular.module("catReceiptApp").service("BundleService",["BundleFactory",function(a){var b=this;this.bundles=[],this.nukeBundles=function(){for(;this.bundles.length>0;)this.bundles.pop();localStorage.setItem("BundleService_bundles",JSON.stringify(this.bundles))},this.flush=function(){localStorage.setItem("BundleService_bundles",JSON.stringify(this.bundles))},this.addBundle=function(a,b,c,d){var e={name:a,cost:b,owner:c,bundle:!0};this.bundles.push(e),d||this.flush()},localStorage.getItem("BundleService_bundles")&&0!==JSON.parse(localStorage.getItem("BundleService_bundles")).length?this.bundles=JSON.parse(localStorage.getItem("BundleService_bundles")):a.request().then(function(c){a.parse(b,c)})}]),angular.module("catReceiptApp").factory("ItemFactory",["$http",function(a){return{request:function(){return a.get("data/items.json")},parse:function(a,b){for(var c,d=0;d<b.data.items.length;d++)c=b.data.items[d],a.addItem(c.name,c.cost,c.owner,c.stock,!0);a.flush()}}}]),angular.module("catReceiptApp").factory("BundleFactory",["$http",function(a){return{request:function(){return a.get("data/bundles.json")},parse:function(a,b){for(var c,d=0;d<b.data.bundles.length;d++)c=b.data.bundles[d],a.addBundle(c.name,c.cost,c.owner,!0);a.flush()}}}]);